language: dart
sudo: false

dart:
  - dev

os:
  - linux
  - osx
  - windows

dart_task:
  - test: --preset travis --total-shards 14 --shard-index 0
  - test: --preset travis --total-shards 14 --shard-index 1
  - test: --preset travis --total-shards 14 --shard-index 2
  - test: --preset travis --total-shards 14 --shard-index 3
  - test: --preset travis --total-shards 14 --shard-index 4
  - test: --preset travis --total-shards 14 --shard-index 5
  - test: --preset travis --total-shards 14 --shard-index 6
  - test: --preset travis --total-shards 14 --shard-index 7
  - test: --preset travis --total-shards 14 --shard-index 8
  - test: --preset travis --total-shards 14 --shard-index 9
  - test: --preset travis --total-shards 14 --shard-index 10
  - test: --preset travis --total-shards 14 --shard-index 11
  - test: --preset travis --total-shards 14 --shard-index 12
  - test: --preset travis --total-shards 14 --shard-index 13
  - dartfmt
  - dartanalyzer

# Create a snapshot to improve startup time. Tests will automatically use this
# snapshot if it's available.
before_script:
  - dart --snapshot=bin/pub.dart.snapshot.dart2 bin/pub.dart

# Only building these branches means that we don't run two builds for each pull
# request.
branches:
  only: [master, travis, /^feature\./]

cache:
  directories:
    - $HOME/.pub-cache
